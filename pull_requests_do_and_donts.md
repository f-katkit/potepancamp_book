# よいPRを立てるには

ポテパンキャンプでは、エンジニア陣が開発現場でやっているような本気のレビューをすることで、プロの開発現場のシミュレーションをしていただいています。

マスターマージできるということは、実際のRails開発現場で本番反映してもらって問題ないとエンジニアが判断するレベルだと思ってください。（最初は承認までに１ヶ月以上かかることをありますが、そこはスクールなので大丈夫です）

１つ１つ丁寧なPRを立て、レビュアーとの質の高いやりとりを体験していただくために、以下のようなルールを設定しています。

* 最初の課題２がマージされるまでは **同時に複数のPRを立てない**

* 同時にオープンできるPRは **最大２つ**

* もちろんローカル作業を並行してもらうのは自由です（コンフリクト解消は自己責任で）

以下に、よいPRを立てる（つまらないミスをしてしまわない）ために注意したいことを並べました。

## 最低限の動作確認をしよう

「動作しない」「マージ不能」なPRは、見ることができないだけでなく、レビュアーの時間を奪うことになります。最低限、エンジニアとして「このコードには問題がない」と言えるようなPRを立てましょう。

* 最低でもローカルマシンでrails serverが問題なく起動することを確認

* チケットに書かれた動作を行って問題ないことを確認

* テストが通っていることを確認

* マージできないコンフリクトが発生している場合は、マージできる状態になるように解消しておく

もし疑問点があって途中状態のコードをPRとして見せる必要がある場合には、タイトルに **WIP** と書いておくことで、「これは作業途中です」（マージしてはいけない）という意図を表明することができます。

## コミットに気をつけよう

* コミットログは大切です。たとえば「決済機能作成、ユーザーモデル改修・商品画面のデザイン変更、モデルのバリデーションテストを追加」というように、いろんな改修を１コミットにまとめてしまうと、他の開発者が意図を理解しづらくなります。

* コミットログには「どこの部分をどう改修したのか」を、端的にわかりやすく表現しましょう。「レビュアーの指摘を反映」とか「一部修正」というログは後から見て何のことかわからなくなります。

* 無関係なファイルをうっかりコミットすることがあります。コミット前・プッシュ前、PR後のタイミングで、かならず差分を確認するくせをつけましょう。

* `.gitignore` をまめに更新しましょう。チーム設定と関係ない個人的な設定ファイル（たとえばrubymineの設定ファイル）については、 `.gitignore_global` に設定することができます。

（参考）コミットをどうするか（何を書くか、日本語・英語、１行・複数行）は現場ごとに文化があります。OSSなど外部に出す場合は、他のコミットメッセージを参考にしつつ、お作法を守るよう留意しましょう。

## リンターを導入しましょう

* 人間の目で確認しづらい単純ミスを直すために、リンターが使えます。

* リンターはコードスタイルを統一するのにも役立ちます。例えばインデント幅がまちまちだったりすると、ブロック終端のendが足りない、HTMLだと閉じタグを忘れる、などというミスが起こりがちです。

* 読みにくいコードは、あとから同じ場所を改修する他の開発者（含む３ヶ月後の自分）を罠にかけることにもなります。

* リンターを使うことで、最低限のスタイルを揃えることが可能です。RubyだとRubocopが有名です。

* Rubocopはデフォルト設定だと少しチューニングが必要になるため、実際の開発現場用にカスタマイズされている設定を導入した方が手間がかかりません。

* オススメとしては[こちらのgem](https://github.com/airbnb/ruby/tree/master/rubocop-airbnb)があります。airbnbの開発で使用されているrubocop設定を自動的に導入してくれます。

* エディタに設定できるプラグインがある場合は導入しておきましょう。

* 最後に目視確認することは常に大切です。

## テストを書きましょう

* テストを書くことで、プログラムが仕様通り動作することを保証することができます。テストは「つくった機能が想定通りに動く」ことを伝えてくれるだけでなく、「未来の改修でうっかりその機能が動かなくなる」という事故を防いでくれます。

* 本番のコードは成長し続けます。数万行、数十万行になったプログラムは、時として「何をさわったらどこが壊れるか想像もつかない」という積み木細工のような状態になることがあります。重要な部分のテストが書かれていると、テストをすべてパスすることが１つの動作保証になるため、安心して改修できます。

* 開発現場には自動テスト（CI）環境があることが一般的です。過去から積み上げられてきた大量のテストを全て通過させることで、改修によってアプリケーションが壊れていないことを自動で確認できます。

* ポテパンでは実際の開発のシミュレーションとしてテストを書くことを強くオススメしています。まずはモデルやコントローラーの単体テストから始めてみましょう。慣れてきたら、統合テスト（主にfeature spec）にもぜひ挑戦してみてください。

* 実際の開発現場で慣れないテストを書くのは大変なものです。今のうちに書けるようになっておきましょう。

* RSpecの良い教材としては、[Everyday Rails - RSpecによるRailsテスト入門](https://leanpub.com/everydayrailsrspec-jp) があります。訳者の一人である伊藤淳一さんによる[Qiita記事](https://qiita.com/jnchito/items/42193d066bd61c740612)もよくまとまっているのでおすすめです。

