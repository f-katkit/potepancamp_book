# これだけは守ろう

PRは特別な能力がいるものではなく、プロの開発者なら当たり前にできることです。
とはいえ、最初は「どんなPRを立てればいいのか」、実践的なツボを知って置いた方がいいでしょう。

以下では、まずどんなPRでも必ず守るべき基本的なルールを挙げます。

大変だと感じるかもしれませんが、慣れるとどれも当たり前のこととしてこなせるようになります。
最初のうちからこれらのことをくせづけて、無意識にこなせるようになりましょう。

### 最低限、動作確認はマスト

とくに初心者のうちは、変なコードを書いてうっかり本番を止めてしまったり、データベースに復旧不可能な損害を与えたりすることも珍しくありません。

最低限、プロのエンジニアとして「このコードには問題がない」と言えるようなPRを立てましょう。

とくに「動作しない」「マージ不能」なPRは、たんに見ることができないだけでなく、レビュアーの時間を奪う行為になりますので、絶対に避けましょう！

* 最低でもローカルマシンでコードが動作することを確認する

  * **rails serverが問題なく起動する** ことを確認

  * チケットに書かれた動作を行って問題ないことを確認

  * テストを走らせて全て通っていることを確認

* マージ先を確認（ポテパンキャンプでのマージは自分自身のリポジトリのmasterブランチに行います）

* コンフリクトが発生していないことを確認。マスターが変更された時は、コンフリクトが起こる場合があるため注意する

* **過去に指摘された内容（もしくは類似の内容）について対応が完了**していることを再確認

もし疑問点があって途中状態のコードをPRとして見せる必要がある場合には、タイトルに **WIP** と書いておくことで、「これは作業途中です」（マージしてはいけない）という意図を表明することができます。

### 必ず差分を見よう

不用意な差分が加わってしまっていることで、せっかくのいいコードをマージできないことがあります。

変なファイルを本番に投入して事故になることを防ぐためにも、必ずPRの差分を確認する習慣をつけましょう。

* **確認のタイミングは３回**あります。つまり `git add` をするとき、 `git commit` をするとき、PRを立てるときです。

  1. `git add` する前に、`git diff` で差分をチェックしましょう。最初は `git add -A` などとせず、`git add [パス名]` とすることで、addしたいファイルやフォルダを個別に指定していくことがお勧めです。（最初はここまでやらなくともいいですが、`git add -p` で差分を細かく積んでいく方法もあります）

  2. `git commit` をする前に `git status` や `git diff HEAD` などで差分を細かく見ておきましょう。無駄なファイルがあれば一度 `git reset` してやり直しましょう

  3. PRを立てた後、レビュー依頼する前に必ず自分でリポジトリを目視確認してください。うっかり変な差分が紛れ込んでいたら修正してから依頼を出しましょう。

* PRを修正した場合は、かならず上で書いた動作確認を行ってください（「最後にコミットをいじったせいで、うっかりコードを壊してしまう」のはよくある現象です）


ここまではどんな開発現場でも共通のお作法です。

### ポテパンキャンプでのPRルール

最後に、ポテパンキャンプにおける運用ルールがあります。
１つ１つ丁寧なPRを立て、レビュアーとの質の高いやりとりを体験していただくために、以下のようなルールを設定しています。

* 最初の課題２がマージされるまでは **同時に複数のPRを立てない**

* 同時にオープンできるPRは **最大２つ**

* もちろんローカル作業を並行してもらうのは自由です（コンフリクト解消は自己責任で）

* その週ごとに「はじめて提出されたPR」を優先的に見ていきます。

「雑でもいいから高速で次々にレビュー依頼を重ねていくスタイル」より、 **「時間をかけて丁寧なPRを立てる姿勢」を応援したい（現場でも仲間にレビューしてもらいやすい開発者になって欲しい）** という意図からこのようなシステムになっています。
